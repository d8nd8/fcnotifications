# FC Phones - –°–µ—Ä–≤–∏—Å –ê–ª–µ—Ä—Ç–æ–≤ —Å Telegram-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏

Django REST API —Å–µ—Ä–≤–∏—Å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏ —Å —É–¥–æ–±–Ω—ã–º–∏ Telegram-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏ –≤ —Ñ–æ—Ä–º–∞—Ç–µ –∞–ª–µ—Ä—Ç–æ–≤.

## üöÄ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏**: –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –ø–æ —Ç–æ–∫–µ–Ω–∞–º
- **–û—Ç—á–µ—Ç—ã –æ –±–∞—Ç–∞—Ä–µ–µ**: –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —É—Ä–æ–≤–Ω—è –∑–∞—Ä—è–¥–∞ –±–∞—Ç–∞—Ä–µ–∏ (0-100%) - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∫ keep-alive
- **–°–æ–æ–±—â–µ–Ω–∏—è**: –ü—Ä–∏–µ–º –∏ —Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π –æ—Ç —É—Å—Ç—Ä–æ–π—Å—Ç–≤
- **Telegram-–∞–ª–µ—Ä—Ç—ã**: –ö—Ä–∞—Å–∏–≤—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ –∞–¥–º–∏–Ω-—á–∞—Ç –ø—Ä–∏ –Ω–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏—è—Ö
- **REST API**: –ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π API —Å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π –ø–æ –∑–∞–≥–æ–ª–æ–≤–∫—É X-TOKEN

## üì± –§–æ—Ä–º–∞—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

–ö–∞–∂–¥–æ–µ –Ω–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –ø—Ä–∏—Ö–æ–¥–∏—Ç –≤ —É–¥–æ–±–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ –∞–ª–µ—Ä—Ç–∞:

```
üö® –ù–û–í–û–ï –°–û–û–ë–©–ï–ù–ò–ï

üì± –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ: –ú–æ–π —Ç–µ–ª–µ—Ñ–æ–Ω
‚è∞ –í—Ä–µ–º—è: 15.01.2024 14:30:25
üë§ –û—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—å: –ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤

üí¨ –°–æ–æ–±—â–µ–Ω–∏–µ:
–ü–æ–º–æ–≥–∏—Ç–µ! –ó–∞—Å—Ç—Ä—è–ª –≤ –ª–∏—Ñ—Ç–µ –Ω–∞ 5 —ç—Ç–∞–∂–µ!
```

## ‚ö° –ë—ã—Å—Ç—Ä—ã–π –∑–∞–ø—É—Å–∫

### 1. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
./setup.sh
```

### 2. –†—É—á–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
# –°–æ–∑–¥–∞—Ç—å –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
python3 -m venv venv
source venv/bin/activate

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
pip install -r requirements.txt

# –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –æ–∫—Ä—É–∂–µ–Ω–∏–µ
cp env.example .env
# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ .env —Ñ–∞–π–ª —Å –≤–∞—à–∏–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏

# –°–æ–∑–¥–∞—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
python manage.py migrate

# –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ
python manage.py create_test_device --name "–ú–æ–π —Ç–µ–ª–µ—Ñ–æ–Ω"
```

### 3. –ó–∞–ø—É—Å–∫

```bash
# –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –æ–∫—Ä—É–∂–µ–Ω–∏–µ
source venv/bin/activate

# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä
python manage.py runserver

# –í –¥—Ä—É–≥–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ - –∑–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞
python bot.py
```

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (.env)

```env
# Django –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
SECRET_KEY=–≤–∞—à-—Å–µ–∫—Ä–µ—Ç–Ω—ã–π-–∫–ª—é—á
DEBUG=True
ALLOWED_HOSTS=localhost,127.0.0.1

# Telegram Bot –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
TELEGRAM_BOT_TOKEN=–≤–∞—à-—Ç–æ–∫–µ–Ω-–±–æ—Ç–∞
TELEGRAM_ADMIN_CHAT_ID=–≤–∞—à-chat-id
```

### –ü–æ–ª—É—á–µ–Ω–∏–µ Telegram —Ç–æ–∫–µ–Ω–∞

1. –°–æ–∑–¥–∞–π—Ç–µ –±–æ—Ç–∞ —á–µ—Ä–µ–∑ [@BotFather](https://t.me/BotFather) –≤ Telegram
2. –ü–æ–ª—É—á–∏—Ç–µ —Ç–æ–∫–µ–Ω –±–æ—Ç–∞
3. –£–∑–Ω–∞–π—Ç–µ ID –≤–∞—à–µ–≥–æ —á–∞—Ç–∞ (–º–æ–∂–Ω–æ —á–µ—Ä–µ–∑ [@userinfobot](https://t.me/userinfobot))
4. –î–æ–±–∞–≤—å—Ç–µ —ç—Ç–∏ –¥–∞–Ω–Ω—ã–µ –≤ —Ñ–∞–π–ª `.env`

## üì° API Endpoints

### –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

–í—Å–µ –∑–∞–ø—Ä–æ—Å—ã —Ç—Ä–µ–±—É—é—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫ `X-TOKEN` —Å —Ç–æ–∫–µ–Ω–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞.

### 1. GET /api/device

–ü–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ.

**–ó–∞–≥–æ–ª–æ–≤–∫–∏:**
```
X-TOKEN: your-device-token
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "id": "12345678-1234-1234-1234-123456789abc",
  "external_id": null,
  "token": "12345678-1234-1234-1234-123456789abc",
  "name": "–ú–æ–π —Ç–µ–ª–µ—Ñ–æ–Ω",
  "last_seen": "2024-01-15T14:30:25Z",
  "created_at": "2024-01-15T10:00:00Z"
}
```

### 2. POST /api/mobile/battery

–û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç—á–µ—Ç –æ –±–∞—Ç–∞—Ä–µ–µ (keep-alive).

**–ó–∞–≥–æ–ª–æ–≤–∫–∏:**
```
X-TOKEN: your-device-token
Content-Type: application/json
```

**–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞:**
```json
{
  "battery_level": 85,
  "date_created": "2024-01-15T14:30:25Z"
}
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "id": "87654321-4321-4321-4321-cba987654321",
  "message": "–û—Ç—á–µ—Ç –æ –±–∞—Ç–∞—Ä–µ–µ —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω"
}
```

### 3. POST /api/mobile/message

–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ (—Å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ–º –≤ Telegram).

**–ó–∞–≥–æ–ª–æ–≤–∫–∏:**
```
X-TOKEN: your-device-token
Content-Type: application/json
```

**–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞:**
```json
{
  "date_created": "2024-01-15T14:30:25Z",
  "sender": "–ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤",
  "text": "–ü–æ–º–æ–≥–∏—Ç–µ! –ó–∞—Å—Ç—Ä—è–ª –≤ –ª–∏—Ñ—Ç–µ –Ω–∞ 5 —ç—Ç–∞–∂–µ!"
}
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "id": "11111111-2222-3333-4444-555555555555",
  "message": "–°–æ–æ–±—â–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ"
}
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã API
python test_api.py
```

## üìä –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö

### Device (–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ)
- `id` (UUID, PK) - –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä
- `external_id` (Text, nullable) - –í–Ω–µ—à–Ω–∏–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä
- `token` (UUID, unique) - –¢–æ–∫–µ–Ω –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- `name` (CharField) - –ù–∞–∑–≤–∞–Ω–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
- `last_seen` (DateTime, nullable) - –í—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ (keep-alive)
- `created_at` (DateTime) - –í—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è

### BatteryReport (–û—Ç—á–µ—Ç –æ –±–∞—Ç–∞—Ä–µ–µ)
- `id` (UUID, PK) - –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä
- `device` (FK to Device) - –°—Å—ã–ª–∫–∞ –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ
- `battery_level` (Integer) - –£—Ä–æ–≤–µ–Ω—å –±–∞—Ç–∞—Ä–µ–∏ (0-100)
- `date_created` (DateTime) - –í—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è –æ—Ç—á–µ—Ç–∞
- `created_at` (DateTime) - –í—Ä–µ–º—è –∑–∞–ø–∏—Å–∏ –≤ –ë–î

### Message (–°–æ–æ–±—â–µ–Ω–∏–µ)
- `id` (UUID, PK) - –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä
- `device` (FK to Device) - –°—Å—ã–ª–∫–∞ –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ
- `date_created` (DateTime) - –í—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏—è
- `sender` (CharField) - –û—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—å
- `text` (TextField) - –¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è
- `raw_payload` (JSONField) - –ò—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å–∞
- `created_at` (DateTime) - –í—Ä–µ–º—è –∑–∞–ø–∏—Å–∏ –≤ –ë–î

## ü§ñ Telegram Bot

–ë–æ—Ç –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Å–ª–µ–¥—É—é—â–∏–µ –∫–æ–º–∞–Ω–¥—ã:
- `/start` - –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
- `/help` - –°–ø—Ä–∞–≤–∫–∞ –ø–æ –∫–æ–º–∞–Ω–¥–∞–º
- `/devices` - –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ —Å —Å—Ç–∞—Ç—É—Å–æ–º –æ–Ω–ª–∞–π–Ω/–æ—Ñ–ª–∞–π–Ω
- `/test` - –û—Ç–ø—Ä–∞–≤–∫–∞ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

## üõ†Ô∏è –ê–¥–º–∏–Ω–∫–∞ Django

–î–æ—Å—Ç—É–ø–Ω–∞ –ø–æ –∞–¥—Ä–µ—Å—É: http://localhost:8000/admin/

–î–ª—è –≤—Ö–æ–¥–∞ —Å–æ–∑–¥–∞–π—Ç–µ —Å—É–ø–µ—Ä–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:

```bash
python manage.py createsuperuser
```

## üìã –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ–± —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ

```bash
curl -H "X-TOKEN: 12345678-1234-1234-1234-123456789abc" \
     http://localhost:8000/api/device
```

### –û—Ç–ø—Ä–∞–≤–∫–∞ –æ—Ç—á–µ—Ç–∞ –æ –±–∞—Ç–∞—Ä–µ–µ (keep-alive)

```bash
curl -X POST \
     -H "X-TOKEN: 12345678-1234-1234-1234-123456789abc" \
     -H "Content-Type: application/json" \
     -d '{"battery_level": 85}' \
     http://localhost:8000/api/mobile/battery
```

### –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è (—Å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ–º –≤ Telegram)

```bash
curl -X POST \
     -H "X-TOKEN: 12345678-1234-1234-1234-123456789abc" \
     -H "Content-Type: application/json" \
     -d '{"sender": "–ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤", "text": "–ü–æ–º–æ–≥–∏—Ç–µ! –ó–∞—Å—Ç—Ä—è–ª –≤ –ª–∏—Ñ—Ç–µ!"}' \
     http://localhost:8000/api/mobile/message
```

## üîÑ –ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã

1. **–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç battery report** ‚Üí `last_seen` –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è (keep-alive)
2. **–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç message** ‚Üí `last_seen` –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è + –∫—Ä–∞—Å–∏–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ Telegram
3. **–ê–¥–º–∏–Ω –≤–∏–¥–∏—Ç –≤ Telegram** –≤—Å–µ –Ω–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —É–¥–æ–±–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ –∞–ª–µ—Ä—Ç–∞
4. **–í –∞–¥–º–∏–Ω–∫–µ Django** –º–æ–∂–Ω–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –ø–æ `last_seen`

## üèóÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
fc_phones/
‚îú‚îÄ‚îÄ fc_phones/          # –û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Django
‚îú‚îÄ‚îÄ devices/            # –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏
‚îÇ   ‚îú‚îÄ‚îÄ models.py       # –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îú‚îÄ‚îÄ views.py        # API –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ serializers.py  # –°–µ—Ä–∏–∞–ª–∏–∑–∞—Ç–æ—Ä—ã
‚îÇ   ‚îú‚îÄ‚îÄ authentication.py # –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ notifications.py # Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ management/     # Management –∫–æ–º–∞–Ω–¥—ã
‚îú‚îÄ‚îÄ bot.py             # Telegram –±–æ—Ç
‚îú‚îÄ‚îÄ manage.py          # Django management
‚îî‚îÄ‚îÄ requirements.txt   # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
```

## üìù TODO

- [ ] –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ –æ—Ç–ø—Ä–∞–≤–∫—É —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –≤ Celery –¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏
- [ ] –î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é —Ç–æ–∫–µ–Ω–æ–≤ –ø–æ –≤—Ä–µ–º–µ–Ω–∏ –∂–∏–∑–Ω–∏
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å rate limiting –¥–ª—è API
- [ ] –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ API –∑–∞–ø—Ä–æ—Å–æ–≤
- [ ] –°–æ–∑–¥–∞—Ç—å API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é —Å Swagger/OpenAPI
- [ ] –î–æ–±–∞–≤–∏—Ç—å –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫—É —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –ø–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License